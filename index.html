<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿπÿ¨ŸÑÿ© ÿßŸÑÿ≠ÿ∏ ÿßŸÑŸÉÿ™ÿßÿ®Ÿäÿ© - ŸÅÿ±ŸÇ</title>
    <style>
        :root {
            --bg-color: #2c3e50;
            --text-color: white;
            --accent-color: #f1c40f;
            --btn-hover: #f39c12;
            --wheel-border: #ecf0f1;
            --selected-color: #2ecc71;
            --team-active: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ====================
           FULL SCREEN BTN
           ==================== */
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 10px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: background 0.2s;
        }
        .fullscreen-btn:hover { background: rgba(0,0,0,0.6); }

        /* ====================
           INTRO SCREEN
           ==================== */
        #introScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            z-index: 50;
            background: var(--bg-color);
            padding: 20px;
            box-sizing: border-box;
            text-align: center;
            overflow-y: auto;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: var(--accent-color);
            text-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .section-title {
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.1rem;
            color: #bdc3c7;
            border-bottom: 1px solid #7f8c8d;
            padding-bottom: 5px;
            width: 100%;
            max-width: 400px;
        }

        /* Team Selector */
        .team-select-grid {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .team-btn {
            background: transparent;
            border: 2px solid #7f8c8d;
            color: #bdc3c7;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .team-btn.selected {
            background: var(--accent-color);
            color: var(--bg-color);
            border-color: var(--accent-color);
            font-weight: bold;
            transform: scale(1.1);
        }

        /* Group Grid */
        .group-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 500px;
            margin-bottom: 25px;
        }

        .group-btn {
            background: white;
            color: var(--bg-color);
            border: 3px solid transparent;
            padding: 12px;
            font-size: 1rem;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            opacity: 0.8;
            transition: all 0.2s;
        }

        .group-btn:hover { opacity: 1; transform: translateY(-2px); }

        .group-btn.selected {
            border-color: var(--selected-color);
            background: #e8f8f5;
            color: #27ae60;
            opacity: 1;
        }

        .start-game-btn {
            background: var(--accent-color);
            color: var(--bg-color);
            border: none;
            padding: 15px 60px;
            font-size: 1.5rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        
        .start-game-btn:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* ====================
           GAME SCREEN & SCOREBOARD
           ==================== */
        #gameScreen {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Scoreboard Bar */
        .scoreboard {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 10px 5px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            z-index: 30;
            box-sizing: border-box;
        }

        .team-card {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 5px 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s;
            flex: 1;
            margin: 0 5px;
            max-width: 100px;
        }

        .team-card.active-turn {
            background: white;
            color: var(--bg-color);
            border-color: var(--accent-color);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(241, 196, 15, 0.5);
        }

        .team-name { font-size: 0.8rem; display: block; margin-bottom: 2px; }
        .team-score { font-size: 1.2rem; font-weight: bold; }

        .wheel-container {
            position: relative;
            width: 75vmin;
            height: 75vmin;
            max-width: 500px;
            max-height: 500px;
            margin-top: 60px; /* Space for scoreboard */
            margin-bottom: 10px;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4));
        }

        canvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .pointer {
            position: absolute;
            top: -25px; left: 50%; transform: translateX(-50%);
            width: 50px; height: 50px;
            background: #e74c3c;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 10;
        }

        button.spin-btn {
            padding: 12px 40px;
            font-size: 1.3rem;
            border: none;
            border-radius: 50px;
            background: var(--accent-color);
            color: var(--bg-color);
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        button.spin-btn:disabled { background: #95a5a6; }

        /* ====================
           MODAL & GAME OVER
           ==================== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-box {
            background: white;
            color: var(--bg-color);
            padding: 25px;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .winner-box {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #2c3e50;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            animation: popIn 0.5s ease;
        }

        .rank-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            text-align: right;
        }
        .rank-item {
            background: rgba(255,255,255,0.3);
            margin: 5px 0;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }

        .question-text { font-size: 1.4rem; margin: 20px 0; font-weight: bold; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .opt-btn { padding: 12px; border: 2px solid #bdc3c7; background: white; border-radius: 10px; font-size: 1rem; cursor: pointer; color: var(--bg-color); }
        .reference-box { display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border-right: 5px solid #2ecc71; text-align: right; }
        
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* Landscape Mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            #gameScreen { flex-direction: row; align-items: center; }
            .scoreboard { width: 150px; height: 100%; top:0; left:0; flex-direction: column; justify-content: center; }
            .wheel-container { margin-top: 0; margin-left: 160px; height: 85vmin; width: 85vmin; }
            .controls { position: absolute; bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>

    <button class="fullscreen-btn" onclick="toggleFullScreen()" title="ŸÖŸÑÿ° ÿßŸÑÿ¥ÿßÿ¥ÿ©">‚õ∂</button>

    <div id="introScreen">
        <h1>ŸÖÿ≥ÿßÿ®ŸÇÿ© ÿßŸÑŸÉÿ™ÿßÿ® ÿßŸÑŸÖŸÇÿØÿ≥</h1>
        
        <div class="section-title">ÿπÿØÿØ ÿßŸÑŸÅÿ±ŸÇ ÿßŸÑŸÖÿ™ŸÜÿßŸÅÿ≥ÿ©</div>
        <div class="team-select-grid">
            <button class="team-btn selected" onclick="selectTeams(1)">1</button>
            <button class="team-btn" onclick="selectTeams(2)">2</button>
            <button class="team-btn" onclick="selectTeams(3)">3</button>
            <button class="team-btn" onclick="selectTeams(4)">4</button>
        </div>

        <div class="section-title">ŸÖÿ¨ŸÖŸàÿπÿ© ÿßŸÑÿ£ÿ≥ÿ¶ŸÑÿ©</div>
        <div class="group-grid">
            <button class="group-btn" id="btn-1" onclick="toggleGroup(1)">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 1 (1-25)</button>
            <button class="group-btn" id="btn-2" onclick="toggleGroup(2)">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 2 (26-50)</button>
            <button class="group-btn" id="btn-3" onclick="toggleGroup(3)">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 3 (51-75)</button>
            <button class="group-btn" id="btn-4" onclick="toggleGroup(4)">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ 4 (76-100)</button>
        </div>

        <button class="start-game-btn" id="startBtn" onclick="confirmStart()" disabled>ÿßÿ®ÿØÿ£ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©</button>
    </div>

    <div id="gameScreen">
        <div class="scoreboard" id="scoreboard">
            </div>

        <div class="wheel-container">
            <div class="pointer"></div>
            <canvas id="wheelCanvas" width="1000" height="1000"></canvas>
        </div>

        <div class="controls">
            <div id="turnMsg" style="color:var(--accent-color); margin-bottom:10px; font-weight:bold;"></div>
            <button class="spin-btn" id="spinBtn" onclick="spin()">ÿØŸàŸëÿ± ÿßŸÑÿπÿ¨ŸÑÿ©!</button>
            <button class="team-btn" style="width:auto; height:auto; padding:5px 15px; border-radius:15px; font-size:0.8rem; margin-top:10px;" onclick="location.reload()">ÿ•ŸÜŸáÿßÿ°</button>
        </div>
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-box">
            <span id="mLevel" style="padding: 5px 12px; border-radius: 12px; color: white; font-size: 0.8rem;"></span>
            <div class="question-text" id="mQuestion">...</div>
            <div class="options-grid" id="mOptions"></div>
            <div class="reference-box" id="mReference"></div>
            <button class="team-btn" id="closeBtn" style="display:none; width:auto; height:auto; padding:10px 30px; background:#2c3e50; color:white; border:none; border-radius:10px; margin-top:15px;" onclick="closeModal()">ÿßŸÑÿ™ÿßŸÑŸä</button>
        </div>
    </div>

    <div class="modal-overlay" id="gameOverModal">
        <div class="winner-box">
            <h2 style="margin:0; font-size:2rem;">üèÜ ÿßŸÑŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑŸÜŸáÿßÿ¶Ÿäÿ©</h2>
            <div id="winnerName" style="font-size:1.5rem; margin:15px 0; font-weight:bold;"></div>
            <ul class="rank-list" id="rankList"></ul>
            <button class="team-btn" style="background:white; color:#2c3e50; width:auto; height:auto; padding:10px 30px; border-radius:20px; font-weight:bold; margin-top:20px;" onclick="location.reload()">ŸÑÿπÿ®ÿ© ÿ¨ÿØŸäÿØÿ©</button>
        </div>
    </div>

    <script src="rawData.js"></script>

    <script>
        // =====================================
        // GLOBAL VARIABLES
        // =====================================
        let allQuestions = [];
        let currentQuestions = [];
        let selectedGroups = new Set();
        let numTeams = 1;
        let scores = [0, 0, 0, 0];
        let currentTeamIndex = 0; // 0 to 3
        let audioCtx = null;
        let hasAnsweredCorrectly = false; // Track if current turn earned points
        
        const levelColors = { 1: "#2ecc71", 2: "#f1c40f", 3: "#e67e22", 4: "#e74c3c" };

        // =====================================
        // 1. SETUP & INTRO
        // =====================================
        window.onload = function() {
            if (typeof rawData !== 'undefined') {
                allQuestions = JSON.parse(JSON.stringify(rawData));
            } else {
                alert("Error: rawData.js not found");
            }
        };

        function selectTeams(n) {
            numTeams = n;
            // Update UI
            const btns = document.querySelectorAll('.team-select-grid .team-btn');
            btns.forEach((b, i) => {
                if (i + 1 === n) b.classList.add('selected');
                else b.classList.remove('selected');
            });
        }

        function toggleGroup(id) {
            const btn = document.getElementById(`btn-${id}`);
            if (selectedGroups.has(id)) {
                selectedGroups.delete(id);
                btn.classList.remove('selected');
            } else {
                selectedGroups.add(id);
                btn.classList.add('selected');
            }
            // Update Start Button
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = (selectedGroups.size === 0);
            startBtn.innerText = selectedGroups.size > 0 ? "ÿßÿ®ÿØÿ£ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©" : "ÿßÿÆÿ™ÿ± ŸÖÿ¨ŸÖŸàÿπÿ©";
        }

        function confirmStart() {
            // Filter Questions
            currentQuestions = allQuestions.filter(q => {
                let g = 0;
                if (q.id <= 25) g = 1;
                else if (q.id <= 50) g = 2;
                else if (q.id <= 75) g = 3;
                else if (q.id <= 100) g = 4;
                return selectedGroups.has(g);
            });

            if(currentQuestions.length === 0) return;

            // Setup Game State
            scores = new Array(numTeams).fill(0);
            currentTeamIndex = 0;
            
            // Build Scoreboard UI
            const sb = document.getElementById('scoreboard');
            sb.innerHTML = '';
            for(let i=0; i<numTeams; i++) {
                sb.innerHTML += `
                    <div class="team-card" id="team-card-${i}">
                        <span class="team-name">ÿßŸÑŸÅÿ±ŸäŸÇ ${i+1}</span>
                        <span class="team-score" id="score-${i}">0</span>
                    </div>
                `;
            }

            // Switch Screens
            document.getElementById('introScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'flex';
            
            updateTurnUI();
            drawWheel();
        }

        function updateTurnUI() {
            // Highlight active team
            for(let i=0; i<numTeams; i++) {
                const card = document.getElementById(`team-card-${i}`);
                if(i === currentTeamIndex) card.classList.add('active-turn');
                else card.classList.remove('active-turn');
            }
            document.getElementById('turnMsg').innerText = `ÿØŸàÿ± ÿßŸÑŸÅÿ±ŸäŸÇ ${currentTeamIndex + 1}`;
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen().catch(e=>{});
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        // =====================================
        // 2. WHEEL LOGIC
        // =====================================
        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const size = 1000; const center = size/2; const radius = size/2 - 20;
        let currentDeg = 0;
        let selectedIndex = -1;

        function drawWheel() {
            if (currentQuestions.length === 0) {
                showGameOver();
                return;
            }

            const sliceDeg = 360 / currentQuestions.length;
            const sliceRad = (sliceDeg * Math.PI) / 180;
            ctx.clearRect(0, 0, size, size);

            for (let i = 0; i < currentQuestions.length; i++) {
                const q = currentQuestions[i];
                const startAngle = (i * sliceRad) - (Math.PI / 2);
                ctx.beginPath();
                ctx.moveTo(center, center);
                ctx.arc(center, center, radius, startAngle, startAngle + sliceRad);
                ctx.closePath();
                ctx.fillStyle = levelColors[q.l];
                ctx.fill();
                ctx.strokeStyle = "#2c3e50"; ctx.lineWidth = 2; ctx.stroke();
                
                // Numbers
                if(currentQuestions.length <= 60) {
                    ctx.save();
                    ctx.translate(center, center);
                    ctx.rotate(startAngle + sliceRad / 2);
                    ctx.textAlign = "right";
                    ctx.fillStyle = "rgba(0,0,0,0.5)"; 
                    ctx.font = "bold 24px Arial";
                    ctx.fillText(q.id, radius - 28, 12);
                    ctx.fillStyle = "#fff"; 
                    ctx.fillText(q.id, radius - 30, 10);
                    ctx.restore();
                }
            }
        }

        function spin() {
            if (currentQuestions.length === 0) return;
            initAudio();
            document.getElementById('spinBtn').disabled = true;
            
            const winnerIdx = Math.floor(Math.random() * currentQuestions.length);
            const winner = currentQuestions[winnerIdx];
            selectedIndex = winnerIdx;

            const sliceDeg = 360 / currentQuestions.length;
            const targetDeg = (winnerIdx * sliceDeg); 
            const randomOffset = (Math.random() * sliceDeg * 0.8) - (sliceDeg * 0.4);
            const totalDeg = currentDeg + 1800 + (360 - targetDeg - (currentDeg % 360) + 360)%360 + randomOffset;

            canvas.style.transform = `rotate(${totalDeg}deg)`;
            canvas.style.transition = "transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)";
            currentDeg = totalDeg;

            let duration = 4000; let start = Date.now();
            function tick() {
                if(Date.now()-start > duration) return;
                playTick();
                setTimeout(tick, 50 + ((Date.now()-start)/duration)**2 * 500);
            }
            tick();

            setTimeout(() => {
                openQuestion(winner); 
                document.getElementById('spinBtn').disabled = false;
            }, 4000);
        }

        // =====================================
        // 3. QUESTION & SCORING
        // =====================================
        function openQuestion(q) {
            hasAnsweredCorrectly = false; // Reset for this turn
            
            const modal = document.getElementById('modal');
            const levelNames = {1:"ÿ≥ŸáŸÑ",2:"ŸÖÿ™Ÿàÿ≥ÿ∑",3:"ÿµÿπÿ®",4:"ÿÆÿ®Ÿäÿ±"};
            
            document.getElementById('mLevel').innerText = `ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${q.l} - ${levelNames[q.l]}`;
            document.getElementById('mLevel').style.background = levelColors[q.l];
            document.getElementById('mQuestion').innerText = q.t;
            
            const optDiv = document.getElementById('mOptions');
            optDiv.innerHTML = "";
            document.getElementById('mReference').style.display = 'none';
            document.getElementById('closeBtn').style.display = 'none';

            let opts = q.o.map((t, i) => ({ t: t, c: (i === q.c) }));
            // Shuffle
            for (let i = opts.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [opts[i], opts[j]] = [opts[j], opts[i]];
            }

            opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "opt-btn";
                btn.innerText = opt.t;
                btn.onclick = () => handleAnswer(btn, opt.c, q.r);
                optDiv.appendChild(btn);
            });

            modal.style.display = 'flex';
        }

        function handleAnswer(btn, isCorrect, ref) {
            const allBtns = document.querySelectorAll('.opt-btn');
            allBtns.forEach(b => b.disabled = true);

            if(isCorrect) {
                playWin();
                btn.style.background = "#2ecc71"; btn.style.color = "white";
                // Add Score (1 point per correct answer)
                scores[currentTeamIndex]++;
                document.getElementById(`score-${currentTeamIndex}`).innerText = scores[currentTeamIndex];
                hasAnsweredCorrectly = true;
            } else {
                playLoss();
                btn.style.background = "#e74c3c"; btn.style.color = "white";
                // Highlight correct
                // Find correct button logic needed if we want to highlight it, 
                // but shuffling makes it tricky without data attr. 
                // Simplified: Just show reference.
            }

            const refBox = document.getElementById('mReference');
            refBox.innerHTML = `<strong>ÿßŸÑÿ¥ÿßŸáÿØ:</strong><br>${ref}`;
            refBox.style.display = 'block';
            document.getElementById('closeBtn').style.display = 'inline-block';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            
            // Remove question
            if (selectedIndex !== -1) {
                currentQuestions.splice(selectedIndex, 1);
                selectedIndex = -1;
            }

            // Switch Turn
            currentTeamIndex++;
            if(currentTeamIndex >= numTeams) currentTeamIndex = 0;
            
            updateTurnUI();
            drawWheel();
        }

        // =====================================
        // 4. GAME OVER
        // =====================================
        function showGameOver() {
            const modal = document.getElementById('gameOverModal');
            const list = document.getElementById('rankList');
            list.innerHTML = "";

            // Create array of {id, score}
            let ranking = scores.map((s, i) => ({ id: i+1, score: s }));
            // Sort Descending
            ranking.sort((a, b) => b.score - a.score);

            document.getElementById('winnerName').innerText = `üéâ ÿßŸÑŸÅÿßÿ¶ÿ≤: ÿßŸÑŸÅÿ±ŸäŸÇ ${ranking[0].id} üéâ`;

            ranking.forEach((r, idx) => {
                let badge = idx === 0 ? "ü•á" : (idx === 1 ? "ü•à" : (idx === 2 ? "ü•â" : ""));
                list.innerHTML += `
                    <li class="rank-item">
                        <span>${badge} ÿßŸÑŸÅÿ±ŸäŸÇ ${r.id}</span>
                        <span>${r.score} ŸÜŸÇÿ∑ÿ©</span>
                    </li>
                `;
            });

            modal.style.display = 'flex';
            playWin();
        }

        // =====================================
        // 5. AUDIO
        // =====================================
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }
        function playTone(f, t, d, v=0.1) {
            if(!audioCtx) return;
            const o=audioCtx.createOscillator(), g=audioCtx.createGain();
            o.type=t; o.frequency.value=f; g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+d);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+d);
        }
        function playTick() { playTone(300,'square',0.05,0.05); }
        function playWin() { 
            playTone(523.25,'sine',0.4,0.2); setTimeout(()=>playTone(659.25,'sine',0.4,0.2),100);
            setTimeout(()=>playTone(783.99,'sine',0.6,0.2),200); setTimeout(()=>playTone(1046.50,'sine',1.0,0.1),300);
        }
        function playLoss() {
            if(!audioCtx) return;
            const o=audioCtx.createOscillator(), g=audioCtx.createGain();
            o.type='sawtooth'; o.frequency.setValueAtTime(150, audioCtx.currentTime);
            o.frequency.linearRampToValueAtTime(50, audioCtx.currentTime+0.5);
            g.gain.setValueAtTime(0.2, audioCtx.currentTime);
            g.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime+0.5);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.5);
        }
    </script>
</body>
</html>
